<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title><%= title %></title>
  <link rel='stylesheet' href='/bower_components/bootstrap/dist/css/bootstrap.min.css'/>
  <style>
    li > img{
      width: 32px;
    }
  </style>
</head>
<body background="imgs/WeChat.jpg">
 <h2 id="wsstatus" align="center" style="color:white;">smileyun_pku微信墙</h2>
  <ul id="messages">
    
  </ul>
<script type="text/javascript" src='/bower_components/jquery/dist/jquery.js'></script>
<script src='/bower_components/jquery/dist/jquery.min.js'></script>
<script src='/bower_components/bootstrap/dist/js/bootstrap.min.js'></script>
<script type="text/javascript">
  var msglist = document.getElementById('messages');
  var wsstatus = document.getElementById("wsstatus");
  var ws = new WebSocket('ws://42.96.177.180:9902');
  ws.onopen=function(evt){
     ws.send('connected')
     wsstatus.innerHTML='欢迎您使用simleyun的微信墙！'
  }
  ws.onmessage = function(evt)
  {
    console.log(evt.data)
    var msg = JSON.parse(evt.data);
    var content = msg.xml.Content[0];
    msg.user = msg.user || {};
    var userName = msg.user.nickname;
    var headimg = msg.user.headimgurl;

    var oLi = document.createElement('li');
    oLi.innerHTML = '<div class="panel panel-danger"> <img height=64px width=64px src="'+headimg+'"><b>'+userName + '</b>:' + content+'</div>';
    msglist.appendChild(oLi);
  };
</script>
</body>
</html>
